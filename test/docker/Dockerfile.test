# test/docker/Dockerfile.test
#
# Docker image for testing install.sh in an isolated environment
#
# This provides a clean Linux environment to test the full installation
# flow including:
#   - SDKMAN installation
#   - Java installation via SDKMAN
#   - zkemails JAR download
#   - PATH configuration
#
# Build:
#   docker build -f test/docker/Dockerfile.test -t zkemails-test .
#
# Run:
#   docker run --rm zkemails-test
#

FROM ubuntu:22.04

# Avoid interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

# Install minimal dependencies
RUN apt-get update && apt-get install -y \
    curl \
    bash \
    ca-certificates \
    zip \
    unzip \
    && rm -rf /var/lib/apt/lists/*

# Create a non-root user for testing
RUN useradd -m -s /bin/bash testuser
USER testuser
WORKDIR /home/testuser

# Copy the install script
COPY --chown=testuser:testuser install.sh /home/testuser/install.sh
RUN chmod +x /home/testuser/install.sh

# Default command runs a basic syntax check
CMD ["bash", "-n", "/home/testuser/install.sh"]
